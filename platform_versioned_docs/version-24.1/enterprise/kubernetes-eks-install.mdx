---
title: Install on an Amazon EKS cluster
description: Deploy Seqera Platform Enterprise on a Kubernetes cluster
date: "11 Sep 2024"
tags: [kubernetes, deployment]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

import CreateNamespace from './_partials/_k8s-install-ns.mdx';
import ConfigureRegistry from './_partials/_k8s-install-registry.mdx';
import DeployManifests from './_partials/_k8s-install-deploy.mdx';

This installation guide describes how to install Seqera Platform on Enterprise on Amazon Web Services (AWS) Elastic Kubernetes Service (EKS). When you complete the steps in this guide you'll have an installation suitable for product use on EKS.

## Prerequisites

- **SMTP server**: If you don't have an email server, use [Amazon Simple Email Service](https://aws.amazon.com/ses/).

- **MySQL database**: An external database, such as one provided by [Amazon Relational Database Service](https://aws.amazon.com/rds/), is highly recommended for production deployments.

- **SSL certificate**: HTTP must not be used in production environments. An SSL certificate is required for your Seqera instance to handle HTTPS traffic. See [SSL/TLS configuration](./configuration/ssl_tls.mdx#aws-deployments-manage-ssl-certificates-with-amazon-certificate-manager-acm) for more information.

- **Optional: AWS Parameter Store**: Store sensitive Seqera configuration values as SecureString [AWS Parameter Store](https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html) parameters. See [AWS Parameter Store configuration](./configuration/aws_parameter_store.mdx) for instructions. This is recommended for production environments. 

- **Optional: DNS**: DNS is required to support human-readable domain names and load-balanced traffic. If you don't have access to a pre-existing DNS service, use [Amazon Route 53](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/Welcome.html).

### Prerequisites for EKS

If you're installing Seqera Enterprise with Kubernetes, an [Elastic Kubernetes Service (EKS)](https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html) cluster is required. See the [EKS documentation](https://docs.aws.amazon.com/eks/latest/userguide/create-cluster.html) to provision your own cluster.

- Kubernetes 1.19 or later

- **Subnet requirements**

  - At least 2 subnets across two different Availability Zones
  - Subnets must be tagged for [AWS Load Balancer Controller auto-discovery](https://docs.aws.amazon.com/eks/latest/userguide/network_reqs.html)
  - Public subnets must be configured to [auto-assign IPs on launch](https://aws.amazon.com/blogs/containers/upcoming-changes-to-ip-assignment-for-eks-managed-node-groups/)
  - Public and private subnets must allow egress traffic to the public internet

- **RBAC requirements**

  - The cluster must be created by a non-root user
  - `aws-auth` must be updated to [allow access to additional IAM users/roles](https://docs.aws.amazon.com/eks/latest/userguide/add-user-role.html) (if needed)

- **Addons**

  - Install the [cert-manager](https://cert-manager.io/docs/)
  - Install the [AWS Load Balancer Controller](https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html)

- **Ingress**

  - ALB provisioning via the [AWS Load Balancer Controller](https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html)
  - ALB integration with the [Amazon Certificate Manager](https://aws.amazon.com/certificate-manager/)

Additionally, the ingress assumes the presence of SSL certificates, DNS resolution, and ALB logging. If you've chosen not to use some or all of these features, you'll need to modify the manifest accordingly before applying it to the cluster.

## AWS setup

Set up commonly-used AWS services for Seqera deployment.

### Fetch Seqera config values from AWS Parameter Store

From version 23.1, you can retrieve Seqera Enterprise configuration values remotely from the AWS Parameter Store. See [AWS Parameter Store configuration](./configuration/aws_parameter_store.mdx) for instructions. 

### Amazon SES

Seqera Enterprise supports AWS Simple Email Service (SES) as an alternative to traditional SMTP servers for sending application emails. 

:::caution
If you use AWS SES in sandbox mode, both the _sender_ and the _receiver_ email addresses must be verified via AWS SES. Sandbox is not recommended for production use. See the [AWS docs](https://docs.aws.amazon.com/ses/latest/dg/request-production-access.html) for instructions to move out of the sandbox.
:::

- See [Obtaining SES SMTP credentials using the SES console](https://docs.aws.amazon.com/ses/latest/dg/smtp-credentials.html#smtp-credentials-console) for instructions to set up SES to send emails from your preferred address. 

- To prevent emails from SES being flagged as spam, see these AWS instructions for setting up an email authentication method:

   - [DKIM for a domain](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/send-email-authentication-dkim-easy-setup-domain.html) 
   
   - [SPF authentication](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/send-email-authentication-spf.html)

#### Managed Redis services

Seqera supports managed Redis services such as [Amazon ElastiCache][aws-elasticache].

- Use a single-node cluster, as multi-node clusters are not supported
- Use an instance with at least 6GB capacity ([cache.m4.large][aws-cache-instances] or greater)

### Amazon RDS

External databases for Seqera Enterprise deployments require:

- A **MySQL8 Community** DB instance
- At least 2 vCPUs, 8 GB memory, and 30 GB SSD storage
- Manual MySQL user and database schema creation. See [Database configuration](./configuration/overview.mdx#seqera-and-redis-databases) for more details.

:::caution 
Recommended instance class and storage requirements depend on the number of parallel pipelines you expect to run. 
:::

<Tabs>
<TabItem value="AWS console" label="AWS console" default>

See [Creating an Amazon RDS DB instance](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_CreateDBInstance.html) to guide you through the external database setup for your production deployment. 

</TabItem>
<TabItem value="AWS CLI" label="AWS CLI" default>

To create a DB instance with the AWS CLI, call the [create-db-instance](https://docs.aws.amazon.com/cli/latest/reference/rds/create-db-instance.html) command, replacing `INSTANCE_NAME`, `SECURITY_GROUP`, `DB_USER`, and `DB_PASSWORD` with your unique values:

```console
aws rds create-db-instance \
    --engine mysql \ 
    --db-instance-identifier INSTANCE_NAME \
    --allocated-storage 30 \
    --db-instance-class db.m5d.large \
    --vpc-security-group-ids SECURITY_GROUP \
    --db-subnet-group SUBNET_GROUP \
    --master-username DB_USER \
    --master-user-password DB_PASSWORD \
```
</TabItem>
</Tabs>

After your database is created:

- Update the inbound rules for the underlying EC2 instance to allow MySQL connections.
- Update your Seqera [configuration](./configuration/overview.mdx#seqera-and-redis-databases) with the database hostname, username, and password.

## Installation

### 1. Create a namespace

<CreateNamespace />

### 2. Configure container registry credentials

<ConfigureRegistry />

### 3. Configure Seqera Platform

Configure the following environment variables. For more information about Seqera configuration options, see [Configuration overview](./configuration/overview.mdx).

:::tip
The `configmap.yml` manifest includes both the `tower.env` and `tower.yml` files. These files are made available to the other containers through volume mounts.
:::

1. Create a file named `configmap.yml` with the following Kubernetes manifest:

    <details>
    <summary>Show `configmap.yml` file</summary>
    ```js file=./_templates/k8s/configmap.yml showLineNumbers
    ```
    </details>

1. Generate two unique secrets with the following command: `openssl rand -base64 32 | tr -d /=+ | cut -c -32`

1. Edit the `configmap.yml` file and set the following environment variables:

    - `TOWER_ROOT_USERS`: Specify your email address
    - `TOWER_JWT_SECRET`: Specify a unique secret that is at least 35 alphanumeric characters
    - `TOWER_CRYPTO_SECRETKEY`: Specify a unique secret.
    - `TOWER_LICENSE`: Specify your Seqera license key, if known. Otherwise, leave this empty.
    - TOWER_REDIS_URL

1. Apply the config map:

    ```
    kubectl apply -f configmap.yml
    ```

    <details>
    <summary>View command output</summary>
    ```
    configmap/tower-backend-cfg created
    configmap/tower-yml created
    ```
    </details>

<!-- replace with proper manifests for EKS -->
### 4. Deploy Seqera

Seqera Platform consists of deployments for a cron service, a backend service, and a frontend service.

1. Create the manifest files:
    - Create a file named `tower-cron.yml` with the following Kubernetes manifest:

      <details>
      <summary>Show `tower-cron.yml` file</summary>
      ```js file=./_templates/k8s/tower-cron.yml showLineNumbers
      ```
      </details>

    - Create a file named `tower-svc.yml` with the following Kubernetes manifest:

      <details>
      <summary>Show `tower-svc.yml` file</summary>
      ```js file=./_templates/k8s/tower-svc.yml showLineNumbers
      ```
      </details>

<DeployManifests step={2} />

### 5. Seqera ingress

An ingress is used to make Seqera Enterprise publicly accessible, load-balance traffic, terminate TLS, and offer name-based virtual hosting. The included ingress manifest will create an external IP address and forward HTTP traffic to the Seqera frontend.

Download and configure the appropriate manifest for your infrastructure.


<details>
<summary>Show `ingress.eks.yml` file</summary>
```js file=./_templates/k8s/ingress.eks.yml showLineNumbers
```
</details>

To deploy the manifest to your cluster, run the following:

    ```bash
    kubectl apply -f ingress.*.yml
    ```

See [Kubernetes ingress][k8s-ingress] for more information. If you don't need to make Seqera externally accessible, use a service resource to expose a [node port][k8s-node-port] or a [load balancer][k8s-load-balancer] service to make it accessible within your intranet.

See the cloud provider documentation for configuring an ingress service on each cloud provider:

- [Amazon][aws-configure-ingress]

### 6. Check status

Check that all services are up and running:

```bash
kubectl get pods
```

### 7. Test the application

See [Test deployment](./testing.mdx).

### Optional: Configure database console

Use the [dbconsole.yml](_templates/k8s/dbconsole.yml) manifest to deploy a simple web frontend to the Seqera database. Though not required, this can be useful for administrative purposes.

1. Deploy the database console:

    ```bash
    kubectl apply -f dbconsole.yml
    ```

1. Enable a port-forward for the database console to your local machine:

    ```bash
    kubectl port-forward deployment/dbconsole 8080:8080
    ```

1. Access the database console in a web browser at `http://localhost:8080`.

## Next steps

- Configure OpenID Connect (OIDC) for seamless integration with your identify provider
- Configure ingress for your public cloud provider for load balancing and TLS termination
- Configure access to your organization's email server
- Configure Data Studios
- Configure pipeline resource optimization
- Configure Wave containers integration


<!-- links -->
[aws-elasticache]: https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/WhatIs.html
[aws-cache-instances]: https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/CacheNodes.SupportedTypes.html
[aws-configure-ingress]: https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.2/guide/ingress/annotations/

[k8s-ingress]: https://kubernetes.io/docs/concepts/services-networking/ingress/
[k8s-load-balancer]: https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer
[k8s-node-port]: https://kubernetes.io/docs/concepts/services-networking/service/#nodeport
