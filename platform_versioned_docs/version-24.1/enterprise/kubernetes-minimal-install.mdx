---
title: Install Seqera Platform on Kubernetes
description: Deploy Seqera Platform Enterprise with Kubernetes
date: "11 Sep 2024"
tags: [kubernetes, deployment]
---

This installation guide describes how to install Seqera Platform on a Kubernetes cluster.

## Prerequisites

The following prerequisites are required to deploy Seqera on a Kubernetes cluster.

- A Kubernetes cluster version 1.30.2 or newer
- The `kubectl` CLI is installed locally
- Access to the cluster with the `cluster-admin` role

## 1. Create a namespace

Create a namespace to isolate Kubernetes resources used by Seqera Platform from the other resources on your cluster.

:::tip
This installation guide assumes the use of `seqera-platform` as the installation namespace. Consider using a different one that better fits your cluster naming convention.
:::

1. Create a namespace for the Seqera resources:

    ```
    kubectl create namespace seqera-platform
    ```

    <details>
    <summary>View command output</summary>
    ```
    namespace/seqera-platform created
    ```
    </details>

1. Switch to the namespace:

    ```
    kubectl config set-context --current --namespace=seqera-platform
    ```

## 2. Configure container registry credentials

Seqera Enterprise is distributed as a collection of Docker containers available through the Seqera container registry [`cr.seqera.io`](https://cr.seqera.io). Contact [support](https://support.seqera.io) to get your container access credentials. After you've received your credentials, grant your cluster access to the registry:

1. Retrieve the `name` and `secret` values from the JSON file that you received from Seqera support.

1. Create a [secret][kubectl-secret] for the image pull secret:

    ```
    kubectl create secret docker-registry cr.seqera.io \
      --docker-server=cr.seqera.io \
      --docker-username='<name>' \
      --docker-password='<secret>'
    ```

    The credential `name` contains a dollar `$` character. Wrap the name in single quotes to prevent the Linux shell from interpreting this value as an environment variable.

    <details>
    <summary>View command output</summary>
    ```
    secret/cr.seqera.io created
    ```
    </details>

1. Confirm that the secret exists:

    ```
    kubectl get secrets cr.seqera.io
    ```

    <details>
    <summary>View command output</summary>
    ```
    NAME           TYPE                             DATA   AGE
    cr.seqera.io   kubernetes.io/dockerconfigjson   1      26s
    ```
    </details>

1. Confirm that you can pull containers from `cr.seqera.io`:

   1. Pull a container from the private repository:

        ```
        kubectl run pull-test --command --restart=Never --image-pull-policy=Always \
          --image cr.seqera.io/private/nf-tower-enterprise/backend:v24.1.4 \
          --overrides='{ "spec": { "imagePullSecrets": [ { "name": "cr.seqera.io" } ] } }' \
          --override-type=strategic -- /bin/true
        ```

        <details>
        <summary>View command output</summary>
        ```
        pod/pull-test created
        ```
        </details>

    1. Confirm that the container was pulled:

        ```
        kubectl get pods/pull-test -o=custom-columns=NAME:.metadata.name,STATUS:.status.phase
        ```

        <details>
        <summary>View command output</summary>
        ```
        NAME        STATUS
        pull-test   Succeeded
        ```
        </details>

## 3. Configure Seqera Platform

Configure the following environment variables. For more information about Seqera configuration options, see [Configuration overview](./configuration/overview.mdx).

:::tip
The `configmap.yml` manifest includes both the `tower.env` and `tower.yml` files. These files are made available to the other containers through volume mounts.
:::

1. Create a file named `configmap.yml` with the following Kubernetes manifest:

    <details>
    <summary>Show `configmap.yml` file</summary>
    ```js file=./_templates/k8s/k8s_min/configmap.yml {10,12-13,22,25-26} showLineNumbers
    ```
    </details>

1. Generate two unique secrets with the following command: `openssl rand -base64 36`

1. Edit the `configmap.yml` file and set the following environment variables:

    - `TOWER_ROOT_USERS`: Specify your email address
    - `TOWER_JWT_SECRET`: Specify a unique secret that is at least 35 alphanumeric characters
    - `TOWER_CRYPTO_SECRETKEY`: Specify a unique secret.
    - `TOWER_LICENSE`: Specify your Seqera license key, if known. Otherwise, leave this empty.

1. Apply the config map:

    ```
    kubectl apply -f configmap.yml
    ```

    <details>
    <summary>View command output</summary>
    ```
    configmap/tower-backend-cfg created
    configmap/tower-yml created
    ```
    </details>

## 4. Deploy a Redis instance

Seqera Enterprise requires a Redis database for caching purposes. Configure Redis manually by deploying a manifest to your cluster.

1. Create a file named `redis.yml` with the following Kubernetes manifest:

    <details>
    <summary>Show `redis.yml` file</summary>
    ```js file=./_templates/k8s/k8s_min/redis.yml {14} showLineNumbers
    ```
    </details>

1. Set the `spec.storageClassName` field for the persistent volume claim:

   1. Obtain the default storage class name that your Kubernetes cluster provides:

       ```
       kubectl get storageclass -o=custom-columns=NAME:.metadata.name,PROVISIONER:.provisioner
       ```

        <details>
        <summary>View command output</summary>
        ```
        NAME       PROVISIONER
        hostpath   docker.io/hostpath
        ```
        </details>

    1. Edit the `redis.yml` file and set `spec.storageClassName` to the name of the default storage class from the output from the previous step.

1. Apply the manifest:

    ```
    kubectl apply -f redis.yml
    ```

    <details>
    <summary>View command output</summary>
    ```
    persistentvolumeclaim/redis-data created
    statefulset.apps/redis created
    service/redis created
    ```
    </details>

1. Confirm that Redis is available:

    ```
    kubectl get statefulsets/redis
    ```

    <details>
    <summary>View command output</summary>
    ```
    NAME    READY   AGE
    redis   1/1     3d5h
    ```
    </details>

## 5. Deploy a MySQL instance

1. Create a file named `mysql.yml` with the following Kubernetes manifest:

    <details>
    <summary>Show `mysql.yml` file</summary>
    ```js file=./_templates/k8s/k8s_min/mysql.yml {14} showLineNumbers
    ```
    </details>

1. Set the `spec.storageClassName` field for the persistent volume claim:

   1. Obtain the default storage class name that your Kubernetes cluster provides:

       ```
       kubectl get storageclass -o=custom-columns=NAME:.metadata.name,PROVISIONER:.provisioner
       ```

        <details>
        <summary>View command output</summary>
        ```
        NAME       PROVISIONER
        hostpath   docker.io/hostpath
        ```
        </details>

    1. Edit the `mysql.yml` file and set `spec.storageClassName` to the name of the default storage class from the output from the previous step.

1. Apply the manifest:

    ```
    kubectl create -f mysql.yml
    ```

    <details>
    <summary>View command output</summary>
    ```
    persistentvolumeclaim/mysql-pvc created
    statefulset.apps/mysql created
    service/mysql created
    ```
    </details>

1. Confirm that MySQL is available:

    ```
    kubectl get statefulsets/redis
    ```

    <details>
    <summary>View command output</summary>
    ```
    NAME    READY   AGE
    mysql   1/1     2d12h
    ```
    </details>


## 6. Deploy Seqera

Seqera Platform consists of deployments for a cron service, a backend service, and a frontend service.

1. Create the manifest files:
    - Create a file named `tower-cron.yml` with the following Kubernetes manifest:

      <details>
      <summary>Show `tower-cron.yml` file</summary>
      ```js file=./_templates/k8s/k8s_min/tower-cron.yml showLineNumbers
      ```
      </details>

    - Create a file named `tower-svc.yml` with the following Kubernetes manifest:

      <details>
      <summary>Show `tower-svc.yml` file</summary>
      ```js file=./_templates/k8s/k8s_min/tower-svc.yml showLineNumbers
      ```
      </details>

1. Deploy the cron service:

      :::caution
      This manifest includes an init container that creates the required database schema the first time it instantiates. This process can take a few minutes to complete and must finish before you instantiate the Seqera backend. Ensure this container is in the `READY` state before proceeding to the next step.
      :::

    1. Apply the `tower-cron.yml` manifest:

        ```
        kubectl apply -f tower-cron.yml
        ```

        <details>
        <summary>View command output</summary>
        ```
        deployment.apps/cron configured
        ```
        </details>

    1. Confirm that cron service deployed successfully:

        ```
        kubectl rollout status deployment/cron
        ```

        <details>
        <summary>View command output</summary>
          deployment "cron" successfully rolled out
        </details>

1. Deploy the backend and frontend services:

    1. Apply the `tower-svc.yml` manifest:

        ```
        kubectl apply -f tower-svc.yml
        ```

        <details>
        <summary>View command output</summary>
        ```
        deployment.apps/backend configured
        deployment.apps/frontend configured
        service/backend configured
        service/frontend configured
        ```
        </details>

    1. Confirm that cron service deployed successfully:

        ```
        kubectl get deployments
        ```

        <details>
        <summary>View command output</summary>
        ```
        NAME       READY   UP-TO-DATE   AVAILABLE   AGE
        backend    1/1     1            1           2d6h
        cron       1/1     1            1           2d6h
        frontend   1/1     1            1           2d6h
        ```
        </details>

## 7. Create a new user account

Use the same email address that you specified for the `TOWER_ROOT_USERS` environment variable.

1. Open a port forward to the frontend to access the Seqera UI:

    ```
    kubectl port-forward services/frontend 8080:80 &
    ```

    <details>
    <summary>View command output</summary>
    Forwarding from 127.0.0.1:8080 -> 8000
    Forwarding from [::1]:8080 -> 8000
    </details>

1. In a web browser, visit `http://localhost:8080/`. In the **Sign in to Seqera platform** form, enter the email address that you set the `TOWER_ROOT_USERS` environment variable to.

1. Create a file named `mailcatcher.yml` with the following manifest:

    <details>
    <summary>Show `mailcatcher.yml` file</summary>
    ```js file=./_templates/k8s/k8s_min/mailcatcher.yml showLineNumbers
    ```
    </details>

1. Deploy the MatchCatcher application, so that you can access the email that Seqera sends with your authentication token:

    ```
    kubectl apply -f mailcatcher.yml
    ```

1. Open a port forward to the MailCatcher application, to access its web UI:

    ```
    kubectl port-forward services/mailcatcher 1080 &
    ```

    <details>
    <summary>View command output</summary>
    ```
    Forwarding from 127.0.0.1:1080 -> 1080
    Forwarding from [::1]:1080 -> 1080
    ```
    </details>

1. In a web browser, visit `http://localhost:1080/`.

1. Open the authentication email with the subject _Complete your sign-in to Seqera_ and select **Complete sign-in**. Seqera redirects your browser to the **Launchpad** page.

1. Optional: To stop the background port forward processes, you can run `jobs` in your shell, and then run `kill -15 <pid>` to stop each process. If you stop the port forward to the frontend, you can no longer access the Seqera UI. We recommend using a cloud provider's load balancers in conjunction with the Kubernetes ingress functionality for persistent access to your installation.

Your installation of Seqera Platform is complete.

## Next steps

- Configure OpenID Connect (OIDC) for seamless integration with your identify provider
- Configure ingress for your public cloud provider for load balancing and TLS termination
- Configure access to your organization's email server


<!-- links -->
[kubectl-secret]: https://kubernetes.io/docs/tasks/configmap-secret/managing-secret-using-kubectl/
